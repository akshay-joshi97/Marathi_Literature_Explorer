<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Books | BookHouse</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header>
  <h1>üìö Books</h1>
</header>

<div class="nav-btn-container">
  <button class="home-btn" onclick="window.location.href='index.html'">üè† Back to Home</button>
</div>

<main class="grid" id="books-container"></main>

<script>
  const container = document.getElementById("books-container");

  const params = new URLSearchParams(window.location.search);
  const genre = params.get("genre");

  async function fetchBooksByGenre(genreName) {
    try {
      const res = await fetch(`https://cjagroxccgawxxehdode.supabase.co/functions/v1/getBooks?genre=${encodeURIComponent(genreName)}`);
      const data = await res.json();

      if (!data.books || data.books.length === 0) {
        container.innerHTML = `<p style="text-align:center; grid-column: span 4;">No books found for this genre.</p>`;
        return;
      }

      data.books.forEach(book => {
        const div = document.createElement("div");
        div.className = "card";

        div.innerHTML = `
          <img src="${book.image_link}" alt="${book.title}">
          <h2>${book.title}</h2>
          <h3>${book.author}</h3>
        `;

        div.onclick = () => {
          const params = new URLSearchParams({
            title: book.title,
            author: book.author,
            publisher: book.publisher,
            genre: genreName,
            published_date: book.published_date,
            page_count: book.page_count,
            description: book.description,
            preview_link: book.preview_link,
            image_link: book.image_link
          }).toString();

          window.location.href = `book.html?${params}`;
        };

        container.appendChild(div);
      });

    } catch (err) {
      console.error("Error fetching books:", err);
      container.innerHTML = `<p style="text-align:center; grid-column: span 4;">Failed to load books.</p>`;
    }
  }

  if (genre) {
    fetchBooksByGenre(genre);
  } else {
    container.innerHTML = `<p style="text-align:center; grid-column: span 4;">No genre selected.</p>`;
  }
</script>
</body>
</html>

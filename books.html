<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Books | BookHouse</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
<header class="books-header">
  <h1 id="books-genre"></h1>
</header>

<div class="nav-btn-container">
  <button class="home-btn" onclick="window.location.href='index.html'">üè† Back to Home</button>
</div>

<main class="grid" id="books-container"></main>

<script>
  const genreMapping = {
    "Drama": "‡§®‡§æ‡§ü‡§ï",
    "Poetry": "‡§ï‡§µ‡§ø‡§§‡§æ",
    "Novels": "‡§ï‡§æ‡§¶‡§Ç‡§¨‡§∞‡•Ä",
    "Short Stories": "‡§≤‡§ò‡•Å‡§ï‡§•‡§æ",
    "Satire": "‡§µ‡§ø‡§®‡•ã‡§¶ / ‡§µ‡•ç‡§Ø‡§Ç‡§ó",
    "Historical": "‡§ê‡§§‡§ø‡§π‡§æ‡§∏‡§ø‡§ï",
    "Literary Criticism": "‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø ‡§∏‡§Æ‡•Ä‡§ï‡•ç‡§∑‡§æ",
    "Children": "‡§¨‡§æ‡§≤‡§∏‡§æ‡§π‡§ø‡§§‡•ç‡§Ø"
  };

  // Get the genre from URL params (only once)
  const params = new URLSearchParams(window.location.search);
  const genre = params.get("genre") || "";
  const marathiGenre = genreMapping[genre] || "";

  // Set header
  document.getElementById("books-genre").innerText = `${marathiGenre} | ${genre}`;

  const container = document.getElementById("books-container");

  async function fetchBooksByGenre(genreName) {
    try {
      const res = await fetch(`https://cjagroxccgawxxehdode.supabase.co/functions/v1/getBooks?genre=${encodeURIComponent(genreName)}`);
      const data = await res.json();

      if (!data.books || data.books.length === 0) {
        container.innerHTML = `<p style="text-align:center; grid-column: span 4;">No books found for this genre.</p>`;
        return;
      }

      data.books.forEach(book => {
        const div = document.createElement("div");
        div.className = "card";

        div.innerHTML = `
          <img src="${book.image_link}" alt="${book.title}">
          <h2>${book.title}</h2>
          <h3>${book.author}</h3>
        `;

        div.onclick = () => {
          const bookParams = new URLSearchParams({
            title: book.title,
            author: book.author,
            publisher: book.publisher,
            genre: genreName,
            published_date: book.published_date,
            page_count: book.page_count,
            description: book.description,
            preview_link: book.preview_link,
            image_link: book.image_link
          }).toString();

          window.location.href = `book.html?${bookParams}`;
        };

        container.appendChild(div);
      });

    } catch (err) {
      console.error("Error fetching books:", err);
      container.innerHTML = `<p style="text-align:center; grid-column: span 4;">Failed to load books.</p>`;
    }
  }

  if (genre) {
    fetchBooksByGenre(genre);
  } else {
    container.innerHTML = `<p style="text-align:center; grid-column: span 4;">No genre selected.</p>`;
  }

  const header = document.querySelector(".books-header");

window.addEventListener("scroll", () => {
  if (window.scrollY > 50) { // start shrinking after 50px scroll
    header.classList.add("shrink");
  } else {
    header.classList.remove("shrink");
  }
});

</script>
</body>
</html>
